# Java åŸç”Ÿæ¨¡å—

<div align="center">

Front Sightï¼ˆå‡†æ˜ŸåŠ©æ‰‹ï¼‰Android åŸç”Ÿå®ç°

ç³»ç»Ÿçº§æ‚¬æµ®çª—åŠŸèƒ½æ ¸å¿ƒæ¨¡å—

</div>

---

## ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
- [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [API å‚è€ƒ](#api-å‚è€ƒ)
- [æŠ€æœ¯è¦ç‚¹](#æŠ€æœ¯è¦ç‚¹)
- [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
- [ç‰ˆæœ¬å…¼å®¹æ€§](#ç‰ˆæœ¬å…¼å®¹æ€§)
- [æƒé™é…ç½®](#æƒé™é…ç½®)
- [è°ƒè¯•æŒ‡å—](#è°ƒè¯•æŒ‡å—)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [ä¸å‰ç«¯åŒæ­¥](#ä¸å‰ç«¯åŒæ­¥)

---

## æ¦‚è¿°

æœ¬ç›®å½•åŒ…å« Front Sightï¼ˆå‡†æ˜ŸåŠ©æ‰‹ï¼‰çš„ Android åŸç”Ÿ Java ä»£ç ï¼Œç”¨äºå®ç°ç³»ç»Ÿçº§æ‚¬æµ®çª—åŠŸèƒ½ã€‚æ‚¬æµ®çª—å…è®¸å‡†æ˜Ÿåœ¨ä»»æ„åº”ç”¨ä¸Šå±‚æ˜¾ç¤ºï¼Œæä¾›çœŸæ­£çš„å…¨å±€å‡†æ˜Ÿè¾…åŠ©ä½“éªŒã€‚

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- ğŸªŸ ç³»ç»Ÿçº§æ‚¬æµ®çª—ï¼Œè¦†ç›–æ‰€æœ‰åº”ç”¨
- ğŸ¯ æ”¯æŒ 6 ç§å‡†æ˜Ÿç±»å‹æ¸²æŸ“
- âš¡ Canvas é«˜æ€§èƒ½ç»˜åˆ¶
- ğŸ”’ å•ä¾‹æ¨¡å¼ç®¡ç†
- ğŸ›¡ï¸ å®Œæ•´çš„æƒé™å¤„ç†æµç¨‹

---

## ç›®å½•ç»“æ„

```
java/
â””â”€â”€ com/
    â””â”€â”€ sight/
        â””â”€â”€ front/
            â””â”€â”€ sight_overlay.java    # æ‚¬æµ®çª—æ ¸å¿ƒå®ç°
```

---

## æ ¸å¿ƒæ¨¡å—

### `sight_overlay.java`

Android ç³»ç»Ÿçº§æ‚¬æµ®çª—å®ç°ï¼Œæä¾›å‡†æ˜Ÿåœ¨æ‰€æœ‰åº”ç”¨ä¸Šæ–¹æ˜¾ç¤ºçš„èƒ½åŠ›ã€‚

---

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    sight_overlay (ç®¡ç†å™¨)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å•ä¾‹æ¨¡å¼ (Double-Checked Locking)                     â”‚  â”‚
â”‚  â”‚  - init(Context)                                      â”‚  â”‚
â”‚  â”‚  - show/hide/update()                                 â”‚  â”‚
â”‚  â”‚  - æƒé™ç®¡ç† (check/requestPermission)                 â”‚  â”‚
â”‚  â”‚  - ç”Ÿå‘½å‘¨æœŸç®¡ç† (release)                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ ç®¡ç†
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OverlayView (è‡ªå®šä¹‰è§†å›¾)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Canvas ç»˜åˆ¶å¼•æ“                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ drawCross()      åå­—å‡†æ˜Ÿ                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ drawTactical()   æˆ˜æœ¯å‡†æ˜Ÿ                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ drawCircle()     åœ†å½¢å‡†æ˜Ÿ                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ drawBracket()    æ–¹æ‹¬å·å‡†æ˜Ÿ                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ drawChevron()    Vå½¢å‡†æ˜Ÿ                          â”‚  â”‚
â”‚  â”‚  â””â”€ drawDot()        å•ç‚¹å‡†æ˜Ÿ                         â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  - onDraw(Canvas)         ç»˜åˆ¶å…¥å£                    â”‚  â”‚
â”‚  â”‚  - setConfig(Config)      é…ç½®æ›´æ–°                    â”‚  â”‚
â”‚  â”‚  - å®æ—¶é‡ç»˜ invalidate()  è§¦å‘åˆ·æ–°                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ æŒæœ‰
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               SightOverlayConfig (é…ç½®ç±»)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ type: String         å‡†æ˜Ÿç±»å‹                       â”‚  â”‚
â”‚  â”‚  â€¢ color: String        é¢œè‰² (#RRGGBB)                â”‚  â”‚
â”‚  â”‚  â€¢ size: double         å¤§å° (dp)                      â”‚  â”‚
â”‚  â”‚  â€¢ thickness: double    ç²—ç»† (dp)                      â”‚  â”‚
â”‚  â”‚  â€¢ showDot: boolean     ä¸­å¿ƒç‚¹å¼€å…³                     â”‚  â”‚
â”‚  â”‚  â€¢ opacity: double      é€æ˜åº¦ (0-1)                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API å‚è€ƒ

### SightOverlayConfig

æ‚¬æµ®çª—é…ç½®æ•°æ®ç±»ã€‚

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `type` | String | `"cross"` | å‡†æ˜Ÿç±»å‹ |
| `color` | String | `"#00FF00"` | å‡†æ˜Ÿé¢œè‰²ï¼ˆåå…­è¿›åˆ¶ï¼‰ |
| `size` | double | `20.0` | å‡†æ˜Ÿå¤§å°ï¼ˆdpï¼‰ |
| `thickness` | double | `2.0` | çº¿æ¡ç²—ç»†ï¼ˆdpï¼‰ |
| `showDot` | boolean | `true` | æ˜¯å¦æ˜¾ç¤ºä¸­å¿ƒç‚¹ |
| `opacity` | double | `1.0` | é€æ˜åº¦ï¼ˆ0-1ï¼‰ |

### æ”¯æŒçš„å‡†æ˜Ÿç±»å‹

| ç±»å‹å€¼ | åç§° | è¯´æ˜ | è§†è§‰æ•ˆæœ |
|--------|------|------|----------|
| `cross` | åå­—å‡†æ˜Ÿ | å››æ–¹å‘çº¿æ¡ï¼Œä¸­é—´ç•™ç©ºéš™ | â”¼ |
| `dot` | å•ç‚¹å‡†æ˜Ÿ | å•ä¸ªä¸­å¿ƒåœ†ç‚¹ | â€¢ |
| `tactical` | æˆ˜æœ¯å‡†æ˜Ÿ | å†…åœ† + å¤–å›´çŸ­çº¿ | â— |
| `circle` | åœ†å½¢å‡†æ˜Ÿ | è™šçº¿åœ†ç¯ | â—‹ |
| `bracket` | æ–¹æ‹¬å·å‡†æ˜Ÿ | å››è§’æ–¹æ‹¬å· | âŒœ âŒ âŒ âŒŸ |
| `chevron` | Vå½¢å‡†æ˜Ÿ | å€’ V å½¢ + ä¸Šæ–¹çŸ­çº¿ | â‹€ |

---

## æŠ€æœ¯è¦ç‚¹

### 1. WindowManager æ‚¬æµ®çª—

æ ¹æ® Android ç‰ˆæœ¬ä½¿ç”¨ä¸åŒçš„çª—å£ç±»å‹ï¼š

```java
// Android 8.0+ (API 26+) ä½¿ç”¨æ–°ç±»å‹
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
    params.type = WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY;
} else {
    // Android 8.0 ä»¥ä¸‹ä½¿ç”¨æ—§ç±»å‹
    params.type = WindowManager.LayoutParams.TYPE_PHONE;
}
```

### 2. å¸ƒå±€å‚æ•°é…ç½®

```java
// çª—å£æ ‡å¿—
params.flags = WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE |      // ä¸è·å–ç„¦ç‚¹
               WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL |    // ä¸æ‹¦æˆªè§¦æ‘¸äº‹ä»¶
               WindowManager.LayoutParams.FLAG_LAYOUT_IN_SCREEN;     // å…¨å±å¸ƒå±€

// åƒç´ æ ¼å¼
params.format = PixelFormat.TRANSLUCENT;  // é€æ˜èƒŒæ™¯

// å¯¹é½æ–¹å¼
params.gravity = Gravity.CENTER;          // å±å¹•å±…ä¸­
```

### 3. æƒé™å¤„ç†

```java
// Android 6.0+ æ£€æŸ¥æƒé™
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
    if (!Settings.canDrawOverlays(context)) {
        // è·³è½¬åˆ°ç³»ç»Ÿè®¾ç½®é¡µé¢
        Intent intent = new Intent(
            Settings.ACTION_MANAGE_OVERLAY_PERMISSION,
            Uri.parse("package:" + context.getPackageName())
        );
        context.startActivity(intent);
    }
}
```

### 4. å•ä¾‹æ¨¡å¼

åŒé‡æ£€æŸ¥é”å®šï¼ˆDCLï¼‰å®ç°çº¿ç¨‹å®‰å…¨å•ä¾‹ï¼š

```java
private static sight_overlay instance;

public static sight_overlay getInstance() {
    if (instance == null) {
        synchronized (sight_overlay.class) {
            if (instance == null) {
                instance = new sight_overlay();
            }
        }
    }
    return instance;
}
```

---

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç”¨æ³•

```java
// 1. åˆå§‹åŒ–ï¼ˆå»ºè®®åœ¨ Application.onCreate ä¸­ï¼‰
sight_overlay.init(context);

// 2. æ£€æŸ¥æƒé™
if (!sight_overlay.checkPermission()) {
    sight_overlay.requestPermission();
    return;
}

// 3. æ˜¾ç¤ºæ‚¬æµ®çª—
sight_overlay.show("cross", "#FF0000", 30.0, 3.0, true, 0.8);

// 4. æ›´æ–°é…ç½®
sight_overlay.update("tactical", "#00FF00", 25.0, 2.0, false, 1.0);

// 5. éšè—æ‚¬æµ®çª—
sight_overlay.hide();

// 6. é‡Šæ”¾èµ„æºï¼ˆå»ºè®®åœ¨ Application.onTerminate ä¸­ï¼‰
sight_overlay.release();
```

### ä¸åŒå‡†æ˜Ÿç±»å‹ç¤ºä¾‹

```java
// æˆ˜æœ¯å‡†æ˜Ÿï¼ˆçº¢è‰²ï¼Œè¾ƒå¤§å°ºå¯¸ï¼‰
sight_overlay.show("tactical", "#FF0000", 30.0, 3.0, true, 0.8);

// åœ†å½¢å‡†æ˜Ÿï¼ˆé’è‰²ï¼Œä¸­ç­‰å°ºå¯¸ï¼‰
sight_overlay.show("circle", "#00FFFF", 25.0, 2.0, true, 0.9);

// æ–¹æ‹¬å·å‡†æ˜Ÿï¼ˆé»„è‰²ï¼Œæ— ä¸­å¿ƒç‚¹ï¼‰
sight_overlay.show("bracket", "#FFFF00", 28.0, 2.5, false, 1.0);

// Vå½¢å‡†æ˜Ÿï¼ˆç´«è‰²ï¼Œå¤§å°ºå¯¸ï¼‰
sight_overlay.show("chevron", "#FF00FF", 32.0, 2.0, true, 0.85);

// å•ç‚¹å‡†æ˜Ÿï¼ˆç™½è‰²ï¼Œå°å°ºå¯¸ï¼‰
sight_overlay.show("dot", "#FFFFFF", 20.0, 1.0, false, 1.0);
```

---

## ç‰ˆæœ¬å…¼å®¹æ€§

| Android ç‰ˆæœ¬ | API Level | æ”¯æŒçŠ¶æ€ | ç‰¹æ®Šå¤„ç† |
|--------------|-----------|----------|----------|
| Android 14+ | 34+ | âœ… å®Œå…¨æ”¯æŒ | éœ€è¦å£°æ˜ `USE_EXACT_ALARM` ç­‰æƒé™ |
| Android 13+ | 33+ | âœ… å®Œå…¨æ”¯æŒ | é€šçŸ¥æƒé™ Runtime |
| Android 12+ | 31+ | âœ… å®Œå…¨æ”¯æŒ | å‰å°æœåŠ¡é™åˆ¶ |
| Android 11+ | 30+ | âœ… å®Œå…¨æ”¯æŒ | åŒ…åå¯è§æ€§ |
| Android 8.0-10 | 26-29 | âœ… å®Œå…¨æ”¯æŒ | ä½¿ç”¨ `TYPE_APPLICATION_OVERLAY` |
| Android 6.0-7.1 | 23-25 | âœ… å®Œå…¨æ”¯æŒ | ä½¿ç”¨ `TYPE_PHONE` + è¿è¡Œæ—¶æƒé™ |
| Android 5.x | 21-22 | âš ï¸ éƒ¨åˆ†æ”¯æŒ | ä»…æ—§æƒé™æ¨¡å‹ |
| Android 4.x åŠä»¥ä¸‹ | <21 | âŒ ä¸æ”¯æŒ | æœªæµ‹è¯• |

---

## æƒé™é…ç½®

### AndroidManifest.xml

```xml
<!-- æ‚¬æµ®çª—æƒé™ -->
<uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" />

<!-- Android 13+ é€šçŸ¥æƒé™ï¼ˆå¦‚éœ€æ˜¾ç¤ºé€šçŸ¥ï¼‰-->
<uses-permission android:name="android.permission.POST_NOTIFICATIONS" />
```

### åŠ¨æ€æƒé™è¯·æ±‚

```java
// åœ¨ Activity ä¸­è¯·æ±‚æƒé™
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
    if (!Settings.canDrawOverlays(this)) {
        new AlertDialog.Builder(this)
            .setTitle("éœ€è¦æ‚¬æµ®çª—æƒé™")
            .setMessage("è¯·æˆäºˆæ‚¬æµ®çª—æƒé™ä»¥ä½¿ç”¨å…¨å±€å‡†æ˜ŸåŠŸèƒ½")
            .setPositiveButton("å»è®¾ç½®", (d, w) -> {
                sight_overlay.requestPermission();
            })
            .setNegativeButton("å–æ¶ˆ", null)
            .show();
    }
}
```

---

## è°ƒè¯•æŒ‡å—

### æŸ¥çœ‹æ—¥å¿—

```bash
# è¿‡æ»¤æ‚¬æµ®çª—ç›¸å…³æ—¥å¿—
adb logcat | grep "SightOverlay"

# æŸ¥çœ‹ Error çº§åˆ«æ—¥å¿—
adb logcat *:E | grep "SightOverlay"

# ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶
adb logcat -d > sight_overlay_log.txt
```

### æ—¥å¿—æ ‡ç­¾

| æ ‡ç­¾ | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| `SightOverlay` | ä¸»è¦æ“ä½œæ—¥å¿— | åˆå§‹åŒ–ã€æ˜¾ç¤ºã€éšè—ã€æ›´æ–° |
| `SightOverlay.Error` | é”™è¯¯æ—¥å¿— | æƒé™ç¼ºå¤±ã€åˆå§‹åŒ–å¤±è´¥ |
| `SightOverlay.Draw` | ç»˜åˆ¶è°ƒè¯• | å‡†æ˜Ÿç±»å‹ã€å°ºå¯¸å‚æ•° |

### å¸¸è§è°ƒè¯•åœºæ™¯

```bash
# 1. æ£€æŸ¥æ‚¬æµ®çª—æƒé™çŠ¶æ€
adb shell appops get <package_name> SYSTEM_ALERT_WINDOW

# 2. æŸ¥çœ‹å½“å‰è¿è¡Œçš„çª—å£
adb shell dumpsys window windows

# 3. æ£€æŸ¥åº”ç”¨è¿›ç¨‹çŠ¶æ€
adb shell ps | grep <package_name>
```

---

## å¸¸è§é—®é¢˜

### Q: æ‚¬æµ®çª—ä¸æ˜¾ç¤º?

**å¯èƒ½åŸå› åŠè§£å†³æ–¹æ¡ˆï¼š**

| åŸå›  | æ£€æŸ¥æ–¹æ³• | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| æœªæˆäºˆæƒé™ | è®¾ç½® â†’ åº”ç”¨ â†’ æ‚¬æµ®çª—æƒé™ | æ‰‹åŠ¨å¼€å¯æƒé™ |
| æœªè°ƒç”¨ init() | æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æœ‰ "Not initialized" | åœ¨ Application.onCreate ä¸­è°ƒç”¨ init() |
| æƒé™è¢«ç³»ç»Ÿæ’¤é”€ | è¿è¡Œæ—¶æ£€æŸ¥ `canDrawOverlays()` | é‡æ–°è¯·æ±‚æƒé™ |
| è¢«å…¶ä»–åº”ç”¨è¦†ç›– | æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿— | æ£€æŸ¥æ˜¯å¦æœ‰å…¨å±åº”ç”¨ |

### Q: é—ªé€€æˆ– SecurityException?

**å¯èƒ½åŸå› ï¼š**

1. âŒ æœªåœ¨ `AndroidManifest.xml` ä¸­å£°æ˜æƒé™
   ```xml
   <uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" />
   ```

2. âŒ åœ¨é UI çº¿ç¨‹æ›´æ–° UI
   ```java
   // ç¡®ä¿åœ¨ä¸»çº¿ç¨‹è°ƒç”¨
   runOnUiThread(() -> sight_overlay.show(...));
   ```

### Q: å‡†æ˜Ÿä½ç½®åç§»?

**è§£å†³æ–¹æ¡ˆï¼š**

æ£€æŸ¥ `LayoutParams.gravity` è®¾ç½®ï¼š

```java
params.gravity = Gravity.CENTER;  // ç¡®ä¿å±…ä¸­
```

æ£€æŸ¥å±å¹•å¯†åº¦é€‚é…ï¼š

```java
// dp è½¬ px
float px = dp * context.getResources().getDisplayMetrics().density;
```

### Q: å‡†æ˜Ÿé¢œè‰²æ˜¾ç¤ºå¼‚å¸¸?

**è§£å†³æ–¹æ¡ˆï¼š**

ç¡®ä¿é¢œè‰²æ ¼å¼æ­£ç¡®ï¼š

```java
// æ­£ç¡®: #RRGGBB
String color = "#00FF00";

// é”™è¯¯: #RGB æˆ–å…¶ä»–æ ¼å¼
String color = "#0F0";  // é”™è¯¯
```

### Q: åˆ‡æ¢å‡†æ˜Ÿç±»å‹æ—¶é—ªçƒ?

**è§£å†³æ–¹æ¡ˆï¼š**

è°ƒç”¨ `invalidate()` è§¦å‘é‡ç»˜è€Œéé‡æ–°åˆ›å»ºçª—å£ï¼š

```java
overlayView.setConfig(newConfig);
overlayView.invalidate();  // ä»…é‡ç»˜ï¼Œä¸é‡å»ºçª—å£
```

---

## ä¸å‰ç«¯åŒæ­¥

Java æ‚¬æµ®çª—å®ç°éœ€è¦ä¸å‰ç«¯ `SightRenderer.vue` ä¿æŒå‡†æ˜Ÿæ¸²æŸ“é€»è¾‘ä¸€è‡´ã€‚

### æ¸²æŸ“å±‚å¯¹åº”å…³ç³»

| å±‚çº§ | æ–‡ä»¶ | å¹³å° | å‡†æ˜Ÿç±»å‹æ”¯æŒ |
|------|------|------|--------------|
| å‰ç«¯æ¸²æŸ“ | [SightRenderer.vue](../src/components/SightRenderer.vue) | H5/å°ç¨‹åº/App å†… | âœ… å…¨éƒ¨ 6 ç§ |
| æ‚¬æµ®çª—æ¸²æŸ“ | [sight_overlay.java](./com/sight/front/sight_overlay.java) | Android æ‚¬æµ®çª— | âœ… å…¨éƒ¨ 6 ç§ |
| ç±»å‹å®šä¹‰ | [types/sight.ts](../src/types/sight.ts) | è·¨å¹³å° | âœ… å…¨éƒ¨ 6 ç§ |

### æ·»åŠ æ–°å‡†æ˜Ÿç±»å‹æ­¥éª¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 1: æ›´æ–°ç±»å‹å®šä¹‰                                    â”‚
â”‚  æ–‡ä»¶: src/types/sight.ts                               â”‚
â”‚  ä¿®æ”¹: SightType ç±»å‹æ·»åŠ æ–°å€¼                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 2: å®ç°å‰ç«¯ç»˜åˆ¶                                    â”‚
â”‚  æ–‡ä»¶: src/components/SightRenderer.vue                 â”‚
â”‚  ä¿®æ”¹: æ·»åŠ  draw*() æ–¹æ³•å’Œ SVG/Canvas é€»è¾‘              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 3: å®ç°æ‚¬æµ®çª—ç»˜åˆ¶                                  â”‚
â”‚  æ–‡ä»¶: java/com/sight/front/sight_overlay.java          â”‚
â”‚  ä¿®æ”¹: OverlayView æ·»åŠ å¯¹åº”çš„ draw*() æ–¹æ³•              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤ 4: æ·»åŠ é¢„è®¾é…ç½®                                    â”‚
â”‚  æ–‡ä»¶: src/types/sight.ts                               â”‚
â”‚  ä¿®æ”¹: PRESET_SIGHTS æ·»åŠ æ–°å‡†æ˜Ÿé¢„è®¾                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®åŒæ­¥ç‚¹

| åŒæ­¥å†…å®¹ | å‰ç«¯ä½ç½® | Java ä½ç½® |
|----------|----------|-----------|
| ç±»å‹å®šä¹‰ | `SightType` | `SightOverlayConfig.type` |
| é»˜è®¤å‚æ•° | `PRESET_SIGHTS` | æ„é€ å‡½æ•°é»˜è®¤å€¼ |
| ç»˜åˆ¶é€»è¾‘ | `draw*()` æ–¹æ³• | `draw*()` æ–¹æ³• |
| å‚æ•°èŒƒå›´ | è°ƒèŠ‚å™¨é™åˆ¶ | æ— é™åˆ¶ï¼ˆç”±å‰ç«¯æ§åˆ¶ï¼‰ |

---

## è®¾è®¡è§„èŒƒ

| å±æ€§ | å€¼ | è¯´æ˜ |
|------|-----|------|
| æ—¥å¿—æ ‡ç­¾ | `SightOverlay` | ç”¨äº logcat è¿‡æ»¤ |
| å•ä¾‹æ¨¡å¼ | Double-Checked Locking | çº¿ç¨‹å®‰å…¨ |
| çª—å£ç±»å‹ | API 26+ / API < 26 | å…¼å®¹ä¸åŒ Android ç‰ˆæœ¬ |
| æœ€å° SDK | API 21 (Android 5.0) | å¯æ ¹æ®éœ€è¦è°ƒæ•´ |
| ç›®æ ‡ SDK | API 34 (Android 14) | è·Ÿéšæœ€æ–°ç³»ç»Ÿ |

---

## ç›¸å…³æ–‡æ¡£

- [ä¸» README](../README.md)
- [å‰ç«¯ç»„ä»¶æ–‡æ¡£](../src/components/SightRenderer.vue)
- [ç±»å‹å®šä¹‰](../src/types/sight.ts)
- [UTS æ’ä»¶æ–‡æ¡£](../uni_modules/sight-overlay/utssdk/app-android/)
